# /var/lib/synapse/homeserver.yaml

# --- code by: @nightlyfoxx on github ---
# --- contacts: https://nightfox.is-a.dev/ ---
#  ,-.       _,---._ __  / \
# /  )    .-'       `./ /   \
# (  (   ,'            `/    /|
# \  `-"             \'\   / |
#  `.              ,  \ \ /  |
#   /`.          ,'-`----Y   |
#  (            ;        |   '
#  |  ,-.    ,-'         |  /
#  |  | (   |            | /
#  )  |  \  `.___________|/
#  `--'   `--'
# --- made with: <3 ---
# --- allowed to fork, reuse and modificate with credits ---

# before you put this as your actual config, create the .env file with all of variables listed below:
# SYNAPSE_DB_PASSWORD="123"
# SYNAPSE_REG_SHARED_SECRET="123"
# SYNAPSE_MACAROON_SECRET_KEY="123"
# SYNAPSE_FORM_SECRET="123"
# SYNAPSE_TURN_SHARED_SECRET="123"
# SYNAPSE_SIGNING_KEY="/path/to/your/signing/key"
# SYNAPSE_SRVNAME="example.com"
# SYNAPSE_PID_FILE="/path/to/pid/file"
# SYNAPSE_MEDIA_DIR="/path/to/media/store/directory"
# SYNAPSE_LOGFILE="/path/to/log/file"
#
# here, replace "123", "/path/to" etc. with your actual passwords and keys!
# of course, you can also replace everything in here with just plain strings, but do NOT put db passwords, secret keys etc. as plain text.
# always use .env!
#
# if you're not sure what all of this means, i recommend you reading this: https://matrix-org.github.io/synapse/latest/setup/installation.html
#
# i have a server with 24gb ram, 10 cores and 450gb nvme, so everything here is adjusted to my powerful ahh specs!
# you'll HAVE to edit it in some way, since no servers are the same! i left some hints right in the configuration, so i think you'll figure everything out ;)
# but, if you didn't, feel free to contact me for help! (links: https://nextdragon.is-a.dev)
#
# happy debugging! :D /hj

server_name: ${SYNAPSE_SRVNAME} # your server name! must be a domain or ip (domain HIGHLY recommended! you can get your own for free on duckdns.org) !! if errors occur because of this, replace with a plain string
pid_file: "${SYNAPSE_PID_FILE}" # your PID file! usually named homeserver.pid and stored in your synapse user's homedir!

# --- listener configuration! ---
# keeping this simple since i already have everything configured in nginx!
listeners:
  - port: 8008
    tls: false
    type: http
    x_forwarded: true
    bind_addresses: ['::1', '127.0.0.1']
    resources:
      - names: [client, federation] # delete "federation" from here if you're not planning on using it! (i explained what it is in README.md)
        compress: false

# --- database configuration! ---
# i use PostgreSQL and i recommend to use it too! (or don't, i'm not your mom :D
# but if you don't, the db configuration will look completely different)
database:
  name: psycopg2
  args:
    user: synapse
    password: "${SYNAPSE_DB_PASSWORD}" # must be the same as "synapse" user's pass in psql!
    database: synapse
    host: localhost
    # database connection pool limits! if you got a potato server (like i did earlier...), set this to cp_min: 5 and cp_max: 10!
    cp_min: 20
    cp_max: 100

# --- misc! ---
enable_registration: true # enable registrations! if disabled, you will only be able to register new users via CLI!
enable_registration_without_verification: true # enable registrations without CAPTCHA / email! can lead to spam bots, but dw if you're not going to make your server large and public
enable_room_list_search: true # enable room list search! (thanks sherlock)
restrict_public_rooms_to_local_users: false
suppress_key_server_warning: true # key server warning is an annoying asshole! ;D /hj

# --- logging and media storing! ---
log_config: "${SYNAPSE_LOGFILE}" # path to server log config file!
media_store_path: "${SYNAPSE_MEDIA_DIR}" # path to media storing folder!
max_upload_size: "50M"  # max upload size (wow, thanks, sherlock x2)! if you have <150GB drive, set to 20mb or less!
media_retention:
  local_media_lifetime: 60d    # delete all media after ...! used to free up disk space, if you want to keep the files forever delete this line!

# --- security and keys! ---
# do NOT replace ANYTHING in here with plain strings expect for signing key path, use .env!
# also please make sure to make a STRONG key, it's not a regular password! it should look like this:
# xT2$kL9!pY7@wE5&vR8*zQ3%mN6^bV4
# or...
# bN7#mK1!pL3$vC9&xZ5*zQ2%wE4^hF8
registration_shared_secret: "${SYNAPSE_REG_SHARED_SECRET}"
report_stats: true
macaroon_secret_key: "${SYNAPSE_MACAROON_SECRET_KEY}"
form_secret: "${SYNAPSE_FORM_SECRET}"
signing_key_path: "${SYNAPSE_SIGNING_KEY}"
trusted_key_servers:
  - server_name: "matrix.org"

# --- TURN configuration (for VoIP/video calls)!
turn_uris:
  - "turn:${SYNAPSE_SRVNAME}?transport=udp" # if errors occur, replace with - "turn:yourdomain.com?transport=udp"!
  - "turn:${SYNAPSE_SRVNAME}?transport=tcp" # if errors occur, replace with - "turn:yourdomain.com?transport=tcp"!
turn_shared_secret: "${SYNAPSE_TURN_SHARED_SECRET}"
turn_user_lifetime: 1h
turn_allow_guests: true

# --- concurrency settings (uncomment ONLY if you have a powerful ass CPU!!!) ---
# event_cache_size: 500M
# state_cache_size: 200M
# presence_cache_size: 10000
# receipt_cache_size: 10000

# vim:ft=yaml